#
# Scrape GOA MinSalud pdfs

import subprocess
import sys

def install(package):
	subprocess.check_call([sys.executable, "-m", "pip", "install", package])

import io

from pdfminer.pdfinterp import PDFResourceManager, PDFPageInterpreter
from pdfminer.converter import TextConverter
from pdfminer.layout import LAParams
from pdfminer.pdfpage import PDFPage

import re


def convert_pdf_to_txt(path):
    rsrcmgr = PDFResourceManager()
    retstr = io.StringIO()
    codec = 'utf-8'
    laparams = LAParams()
    device = TextConverter(rsrcmgr, retstr, codec=codec, laparams=laparams)
    fp = open(path, 'rb')
    interpreter = PDFPageInterpreter(rsrcmgr, device)
    password = ""
    maxpages = 0
    caching = True
    pagenos = set()

    for page in PDFPage.get_pages(fp, pagenos, maxpages=maxpages,
                                  password=password,
                                  caching=caching,
                                  check_extractable=True):
        interpreter.process_page(page)



    fp.close()
    device.close()
    text = retstr.getvalue()
    retstr.close()
    return text

# Convert pdf to text and take out excess spaces
text = convert_pdf_to_txt("minsalud/01-05-20-reporte-matutino-covid-19.pdf")
text = " ".join(text.split())

date_pattern = re.compile(r'([\d]+\/[\d]+\/[\d]+) REPORTE DIARIO (\w+)')
match = re.match(date_pattern,text)
date = match.group(1)
am_pm = match.group(2)

cases_pattern = re.compile(r'El total de casos confirmados en Argentina es de (\d+|\d+.\d+),')
match = re.findall(cases_pattern,text)
cases = "".join(match[0].split('.'))

print(date)
print(am_pm)
print(cases)